{% extends "dashboard_base.html" %}
{% block page_title %}User Dashboard{% endblock %}
{% block inner %}

<div class="kpis">
  <div class="kpi">
    <div class="kpi-label">Online Devices</div>
    <div class="kpi-value">{{ agg.online }}</div>
    <div class="kpi-trend">Uptime {{ agg.uptime_pct }}%</div>
  </div>
  <div class="kpi">
    <div class="kpi-label">Total Devices</div>
    <div class="kpi-value">{{ agg.total }}</div>
    <div class="kpi-trend">â€”</div>
  </div>
  <div class="kpi">
    <div class="kpi-label">Unusual Activity</div>
    <div class="kpi-value">{{ agg.unusual }}</div>
    <div class="kpi-trend">Monitoring</div>
  </div>
</div>

<div class="grid-2">
  <div class="panel">
    <div class="panel-head">
      <h3 class="panel-title">Recent Security Events</h3>
      <div class="panel-actions">
        <button class="btn ghost">View All</button>
      </div>
    </div>
    <div class="panel-body">
      <ul class="timeline">
        {% for e in events %}
        <li class="timeline-item">
          <div class="dot"></div>
          <div class="timeline-main">
            <div class="timeline-title">
              <span class="badge sev sev-{{ e.severity }}">{{ e.severity|title }}</span>
              <strong>{{ e.event_type }}</strong>
            </div>
            <div class="timeline-sub">{{ e.timestamp.strftime("%Y-%m-%d %H:%M") }} UTC</div>
            <div class="timeline-desc">{{ e.description }}</div>
          </div>
        </li>
        {% else %}
        <li class="timeline-item">
          <div class="dot"></div>
          <div class="timeline-main">
            <div class="timeline-title"><span class="badge sev sev-info">Info</span> <strong>No recent alerts</strong></div>
            <div class="timeline-sub">You're all clear.</div>
          </div>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="panel">
    <div class="panel-head">
      <h3 class="panel-title">My Devices</h3>
      <div class="panel-actions">
        <button class="btn ghost">Add Device</button>
      </div>
    </div>
    <div class="panel-body">
      <ul class="list">
        {% for d in devices %}
        <li class="list-item">
          <div class="list-col">
            <div class="title">{{ d.hostname }}</div>
            <div class="sub">{{ d.os }} â€” {{ d.ip }}</div>
          </div>
          <span class="pill">
            {% if d.status == 'online' %}ðŸŸ¢ Online{% else %}ðŸ”´ Offline{% endif %}
          </span>
        </li>
        {% else %}
        <li class="list-item">
          <div class="list-col">
            <div class="title">No devices</div>
            <div class="sub">Ask your admin to assign a device.</div>
          </div>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
</div>
{% endblock %}
