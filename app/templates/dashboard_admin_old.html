{% extends "base.html" %}
{% block title %}Admin · TenshiGuard{% endblock %}
{% block page_title %}Organization Admin Dashboard{% endblock %}

{% block content %}
<!-- KPI Row -->
<section class="kpis">
  <div class="kpi">
    <div class="kpi-label">Active Alerts</div>
    <div class="kpi-value" id="kpi-alerts">—</div>
    <div class="kpi-trend" id="kpi-alerts-trend">Updating…</div>
  </div>
  <div class="kpi">
    <div class="kpi-label">Active Devices</div>
    <div class="kpi-value" id="kpi-devices">—</div>
    <div class="kpi-trend" id="kpi-devices-trend">Updating…</div>
  </div>
  <div class="kpi">
    <div class="kpi-label">System Uptime</div>
    <div class="kpi-value" id="kpi-uptime">—</div>
    <div class="kpi-trend">Since service start</div>
  </div>
</section>

<!-- Two Columns -->
<section class="grid-2">
  <!-- Users -->
  <div class="panel">
    <div class="panel-head">
      <h2 class="panel-title">Users</h2>
    </div>
    <div class="panel-body">
      {% if users and users|length > 0 %}
      <ul class="list">
        {% for u in users %}
          <li class="list-item">
            <div class="avatar">{{ u.username[:1]|upper }}</div>
            <div class="list-col">
              <div class="title">{{ u.username }}</div>
              <div class="sub">{{ u.email }}</div>
            </div>
            <div class="pill">{{ u.role|capitalize }}</div>
          </li>
        {% endfor %}
      </ul>
      {% else %}
        <div class="empty">No users yet.</div>
      {% endif %}
    </div>
  </div>

  <!-- Events -->
  <div class="panel">
    <div class="panel-head">
      <h2 class="panel-title">Recent Security Events</h2>
      <div class="panel-actions">
        <button class="btn ghost" id="btn-refresh-events" title="Refresh">Refresh</button>
      </div>
    </div>
    <div class="panel-body">
      {% if events and events|length > 0 %}
      <ul class="timeline" id="eventsList">
        {% for e in events %}
          <li class="timeline-item sev-{{ e.severity|lower }}">
            <div class="dot"></div>
            <div class="timeline-main">
              <div class="timeline-title">
                <span class="badge sev">{{ e.severity|capitalize }}</span>
                <strong>{{ e.event_type }}</strong>
              </div>
              <div class="timeline-sub">
                {{ e.timestamp.strftime("%Y-%m-%d %H:%M:%S") }}
                {% if e.source_ip %} • Src IP: {{ e.source_ip }}{% endif %}
                {% if e.location %} • {{ e.location }}{% endif %}
              </div>
              {% if e.description %}
              <div class="timeline-desc">{{ e.description }}</div>
              {% endif %}
            </div>
          </li>
        {% endfor %}
      </ul>
      {% else %}
        <div class="empty">No events yet.</div>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}
